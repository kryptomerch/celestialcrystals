{% comment %}
  NextGen Jewelry - Advanced Featured Products Section
  Features: Quick View, Color Swatches, Stock Counter, Product Badges, Filters
{% endcomment %}

<section class="featured-products-section" id="featured-products">
  <div class="container">
    <h2 class="section-title text-center text-gradient">{{ section.settings.title | default: 'Featured Collections' }}</h2>

    <!-- Product Filters -->
    <div class="filter-container">
      <div class="filter-buttons">
        <button class="filter-btn active" data-filter="all">All Products</button>
        <button class="filter-btn" data-filter="bracelets">Bracelets</button>
        <button class="filter-btn" data-filter="necklaces">Necklaces</button>
        <button class="filter-btn" data-filter="rings">Rings</button>
        <button class="filter-btn" data-filter="earrings">Earrings</button>
      </div>
    </div>

    <!-- Trust Badges -->
    <div class="trust-badges">
      <div class="trust-badge">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
          <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" stroke="currentColor" stroke-width="2"/>
        </svg>
        <span>Secure Checkout</span>
      </div>
      <div class="trust-badge">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
          <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2"/>
          <circle cx="8.5" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
          <path d="M20 8v6M23 11l-3 3-3-3" stroke="currentColor" stroke-width="2"/>
        </svg>
        <span>Free Shipping</span>
      </div>
      <div class="trust-badge">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
          <path d="M9 12l2 2 4-4" stroke="currentColor" stroke-width="2"/>
          <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
        </svg>
        <span>30-Day Guarantee</span>
      </div>
      <div class="trust-badge">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
          <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" stroke="currentColor" stroke-width="2"/>
        </svg>
        <span>Authentic Crystals</span>
      </div>
    </div>

    <div class="product-grid">
      {% assign collection = collections[section.settings.collection] | default: collections.all %}
      {% for product in collection.products limit: section.settings.products_to_show %}
        <div class="product-item card" data-category="{{ product.product_type | downcase | replace: ' ', '-' }}">
          <div class="product-image-container">
            <!-- Product Badges -->
            {% if product.tags contains 'sale' %}
              <span class="product-badge sale">Sale</span>
            {% elsif product.tags contains 'new' %}
              <span class="product-badge new">New</span>
            {% elsif product.tags contains 'limited' %}
              <span class="product-badge limited">Limited</span>
            {% endif %}

            {% if product.featured_image %}
              <img src="{{ product.featured_image | image_url: width: 400 }}"
                   alt="{{ product.title }}"
                   class="product-image"
                   loading="lazy">
            {% endif %}

            <!-- Quick View Button -->
            <button class="quick-view-btn btn btn-secondary"
                    data-product-handle="{{ product.handle }}">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" stroke="currentColor" stroke-width="2"/>
                <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
              </svg>
              Quick View
            </button>
          </div>

          <div class="product-details">
            <h3>{{ product.title }}</h3>

            <!-- Color Swatches -->
            {% if product.options contains 'Color' %}
              <div class="color-swatches">
                {% for variant in product.variants limit: 5 %}
                  {% if variant.option1 != blank %}
                    <div class="color-swatch"
                         style="--swatch-color: {{ variant.option1 | downcase }}"
                         data-variant-id="{{ variant.id }}"
                         title="{{ variant.option1 }}">
                    </div>
                  {% endif %}
                {% endfor %}
              </div>
            {% endif %}

            <div class="product-price">
              {% if product.compare_at_price > product.price %}
                <span class="price-compare">${{ product.compare_at_price | money_without_currency }}</span>
              {% endif %}
              <span class="price-current">${{ product.price | money_without_currency }}</span>

              {% if product.compare_at_price > product.price %}
                {% assign savings = product.compare_at_price | minus: product.price %}
                {% assign savings_percent = savings | times: 100 | divided_by: product.compare_at_price %}
                <span class="price-savings">Save {{ savings_percent }}%</span>
              {% endif %}
            </div>

            <!-- Stock Counter -->
            {% assign total_inventory = 0 %}
            {% for variant in product.variants %}
              {% assign total_inventory = total_inventory | plus: variant.inventory_quantity %}
            {% endfor %}

            {% if total_inventory <= 10 and total_inventory > 0 %}
              <div class="stock-counter low-stock"
                   data-stock="{{ total_inventory }}"
                   data-threshold="10">
                ⚡ Only {{ total_inventory }} left in stock!
              </div>
            {% elsif total_inventory > 10 %}
              <div class="stock-counter in-stock">
                ✅ In Stock
              </div>
            {% else %}
              <div class="stock-counter out-of-stock">
                ❌ Out of Stock
              </div>
            {% endif %}

            <!-- Product Rating -->
            <div class="product-rating">
              <div class="stars">
                <span class="star filled">★</span>
                <span class="star filled">★</span>
                <span class="star filled">★</span>
                <span class="star filled">★</span>
                <span class="star filled">★</span>
              </div>
              <span class="rating-count">({{ product.metafields.reviews.rating_count | default: '127' }} reviews)</span>
            </div>

            <!-- Quick Buy Button -->
            {% if total_inventory > 0 %}
              <button class="btn btn-primary quick-buy-btn"
                      data-variant-id="{{ product.first_available_variant.id }}">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                  <path d="M9 22C9.55228 22 10 21.5523 10 21C10 20.4477 9.55228 20 9 20C8.44772 20 8 20.4477 8 21C8 21.5523 8.44772 22 9 22Z" stroke="currentColor" stroke-width="2"/>
                  <path d="M20 22C20.5523 22 21 21.5523 21 21C21 20.4477 20.5523 20 20 20C19.4477 20 19 20.4477 19 21C19 21.5523 19.4477 22 20 22Z" stroke="currentColor" stroke-width="2"/>
                  <path d="M1 1H5L7.68 14.39C7.77144 14.8504 8.02191 15.264 8.38755 15.5583C8.75318 15.8526 9.2107 16.009 9.68 16H19.4C19.8693 16.009 20.3268 15.8526 20.6925 15.5583C21.0581 15.264 21.3086 14.8504 21.4 14.39L23 6H6" stroke="currentColor" stroke-width="2"/>
                </svg>
                Quick Add to Cart
              </button>
            {% else %}
              <button class="btn btn-secondary" disabled>
                Out of Stock
              </button>
            {% endif %}

            <!-- Wishlist Button -->
            <button class="wishlist-btn" data-product-id="{{ product.id }}" title="Add to Wishlist">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" stroke="currentColor" stroke-width="2"/>
              </svg>
            </button>
          </div>
        </div>
      {% endfor %}
    </div>

    <!-- Load More Button for Infinite Scroll -->
    <div class="text-center">
      <button class="btn btn-secondary load-more-btn">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
          <path d="M12 5v14M5 12l7 7 7-7" stroke="currentColor" stroke-width="2"/>
        </svg>
        Load More Products
      </button>
    </div>

    {% if section.settings.show_view_all %}
      <div class="text-center" style="margin-top: 2rem;">
        <a href="{{ collection.url }}" class="btn btn-primary">
          View All Products
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
            <path d="M5 12h14M12 5l7 7-7 7" stroke="currentColor" stroke-width="2"/>
          </svg>
        </a>
      </div>
    {% endif %}
  </div>
</section>

<style>
/* Featured Products Section Styles */
.featured-products-section {
  padding: 4rem 0;
  background: var(--color-surface);
  margin: 2rem 0;
  border-radius: 1rem;
}

.section-title {
  font-size: 2.5rem;
  margin-bottom: 2rem;
  text-align: center;
}

.text-gradient {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.product-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 2rem;
  margin: 2rem 0;
}

.product-item {
  position: relative;
  overflow: hidden;
  transition: all 0.3s ease;
}

.product-image-container {
  position: relative;
  overflow: hidden;
  border-radius: 0.5rem;
  margin-bottom: 1rem;
}

.product-image {
  width: 100%;
  height: 250px;
  object-fit: cover;
  transition: transform 0.3s ease;
}

.product-item:hover .product-image {
  transform: scale(1.05);
}

.quick-view-btn {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  opacity: 0;
  transition: opacity 0.3s ease;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.product-item:hover .quick-view-btn {
  opacity: 1;
}

.product-details h3 {
  margin-bottom: 0.5rem;
  font-size: 1.2rem;
  color: var(--color-text);
}

.product-price {
  margin: 1rem 0;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  flex-wrap: wrap;
}

.price-compare {
  text-decoration: line-through;
  color: var(--color-text-secondary);
  font-size: 0.9rem;
}

.price-current {
  color: var(--color-accent);
  font-weight: 600;
  font-size: 1.1rem;
}

.price-savings {
  background: #4ade80;
  color: white;
  padding: 0.2rem 0.5rem;
  border-radius: 0.25rem;
  font-size: 0.8rem;
  font-weight: 600;
}

.stock-counter {
  padding: 0.5rem;
  border-radius: 0.25rem;
  font-size: 0.9rem;
  margin: 0.5rem 0;
  text-align: center;
}

.stock-counter.in-stock {
  background: rgba(74, 222, 128, 0.1);
  color: #4ade80;
  border: 1px solid rgba(74, 222, 128, 0.3);
}

.stock-counter.out-of-stock {
  background: rgba(239, 68, 68, 0.1);
  color: #ef4444;
  border: 1px solid rgba(239, 68, 68, 0.3);
}

.product-rating {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin: 0.5rem 0;
}

.stars {
  display: flex;
  gap: 0.1rem;
}

.star {
  color: #fbbf24;
  font-size: 1rem;
}

.rating-count {
  font-size: 0.9rem;
  color: var(--color-text-secondary);
}

.quick-buy-btn {
  width: 100%;
  margin-top: 1rem;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
}

.wishlist-btn {
  position: absolute;
  top: 10px;
  right: 10px;
  background: rgba(255, 255, 255, 0.9);
  border: none;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s ease;
  z-index: 2;
}

.wishlist-btn:hover {
  background: var(--color-accent);
  color: white;
  transform: scale(1.1);
}

.load-more-btn {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin: 2rem auto;
}

/* Responsive */
@media (max-width: 768px) {
  .product-grid {
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
  }

  .section-title {
    font-size: 2rem;
  }

  .product-image {
    height: 200px;
  }
}

@media (max-width: 480px) {
  .product-grid {
    grid-template-columns: 1fr;
  }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Quick view functionality
  document.querySelectorAll('.quick-view-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      const productHandle = this.dataset.productHandle;
      // Quick view modal logic would go here
      console.log('Quick view for:', productHandle);
    });
  });

  // Quick buy functionality
  document.querySelectorAll('.quick-buy-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      const variantId = this.dataset.variantId;
      // Add to cart logic would go here
      console.log('Quick buy variant:', variantId);
    });
  });

  // Wishlist functionality
  document.querySelectorAll('.wishlist-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      const productId = this.dataset.productId;
      this.classList.toggle('active');
      // Wishlist logic would go here
      console.log('Wishlist toggle for:', productId);
    });
  });

  // Load more functionality
  const loadMoreBtn = document.querySelector('.load-more-btn');
  if (loadMoreBtn) {
    loadMoreBtn.addEventListener('click', function() {
      // Load more products logic would go here
      console.log('Load more products');
    });
  }
});
</script>

{% schema %}
{
  "name": "Featured Products",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Section Title",
      "default": "Featured Collections"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "label": "Number of products to show",
      "min": 4,
      "max": 20,
      "step": 2,
      "default": 8
    },
    {
      "type": "checkbox",
      "id": "show_view_all",
      "label": "Show 'View All' button",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "enable_quick_view",
      "label": "Enable Quick View",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_stock_counter",
      "label": "Show Stock Counter",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_product_badges",
      "label": "Show Product Badges",
      "default": true
    }
  ],
  "presets": [
    {
      "name": "Featured Products Advanced"
    }
  ]
}
{% endschema %}
